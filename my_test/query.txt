USE [LoveLife]
GO
/****** Object:  StoredProcedure [dbo].[SPTopLikeValentineContent]    Script Date: 2/1/2017 5:43:41 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Md. Ruhul Amin>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
ALTER PROCEDURE [dbo].[SPTopLikeValentineContent]
	@startingIndex int = 0,
	@noOfPage int = 4
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

  
		/*SELECT vl.[Id]
			  ,vl.[UserCode]
			  ,tu.[UserName]
			  ,tu.[FullName]
			  ,tu.[Photo]
			  ,vl.[Activity_Type]
			  ,vl.[Photo_Path]
			  ,case when t1.TotalLike  is null then 0 else t1.TotalLike end as TotalLike
		  FROM [LoveLife].[dbo].[tbl_ValentineContest] vl left outer join
		  (
		SELECT [UserCode]
			  ,count([ValentineContestId]) as TotalLike     
		  FROM [LoveLife].[dbo].[tbl_ValentineContestSelfieLikes]
		  group by [UserCode]) t1 on
		  vl.UserCode=t1.UserCode

		  INNER JOIN [LoveLife].[dbo].[tbl_Users] tu on vl.UserCode = tu.UserCode
		  
		  order by TotalLike desc*/

		  SELECT vl.[Id]
			  ,vl.[UserCode]
			  ,tu.[UserName]
			  ,tu.[FullName]
			  ,tu.[Photo]
			  ,vl.[Activity_Type]
			  ,vl.[Photo_Path]
			  ,(SELECT 
			  count([ValentineContestId]) as TotalLike     
		  FROM [LoveLife].[dbo].[tbl_ValentineContestSelfieLikes] WHERE [ValentineContestId] = vl.[Id]
		  group by [ValentineContestId]) as TotalLike
		  FROM [LoveLife].[dbo].[tbl_ValentineContest] vl 

		  INNER JOIN [LoveLife].[dbo].[tbl_Users] tu on vl.UserCode = tu.UserCode

		  order by TotalLike desc
		  OFFSET @startingIndex ROWS
			FETCH NEXT @noOfPage ROWS ONLY

END
